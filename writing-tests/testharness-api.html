<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>testharness.js API &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="testdriver.js Automation" href="testdriver.html" />
    <link rel="prev" title="JavaScript Tests (testharness.js)" href="testharness.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="testharness-js-api">
<h1>testharness.js API<a class="headerlink" href="#testharness-js-api" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#markup" id="id1">Markup</a></p>
<ul>
<li><p><a class="reference internal" href="#harness-timeout" id="id2">Harness Timeout</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#defining-tests" id="id3">Defining Tests</a></p>
<ul>
<li><p><a class="reference internal" href="#synchronous-tests" id="id4">Synchronous Tests</a></p></li>
<li><p><a class="reference internal" href="#asynchronous-tests" id="id5">Asynchronous Tests</a></p></li>
<li><p><a class="reference internal" href="#promise-tests" id="id6">Promise Tests</a></p></li>
<li><p><a class="reference internal" href="#single-page-tests" id="id7">Single Page Tests</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#making-assertions" id="id8">Making assertions</a></p>
<ul>
<li><p><a class="reference internal" href="#optional-features" id="id9">Optional Features</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-across-globals" id="id10">Testing Across Globals</a></p>
<ul>
<li><p><a class="reference internal" href="#consolidating-tests-from-other-documents" id="id11">Consolidating tests from other documents</a></p></li>
<li><p><a class="reference internal" href="#web-workers" id="id12">Web Workers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cleanup" id="id13">Cleanup</a></p>
<ul>
<li><p><a class="reference internal" href="#abortsignal-support" id="id14">AbortSignal support</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#timers-in-tests" id="id15">Timers in Tests</a></p></li>
<li><p><a class="reference internal" href="#harness-configuration" id="id16">Harness Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#setup" id="id17">Setup</a></p></li>
<li><p><a class="reference internal" href="#output" id="id18">Output</a></p></li>
<li><p><a class="reference internal" href="#determining-when-all-tests-are-complete" id="id19">Determining when all tests are complete</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reporting-api" id="id20">Reporting API</a></p>
<ul>
<li><p><a class="reference internal" href="#callbacks" id="id21">Callbacks</a></p></li>
<li><p><a class="reference internal" href="#external-api" id="id22">External API</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#assert-functions" id="id23">Assert Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#promise-rejection" id="id24">Promise Rejection</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#test-objects" id="id25">Test Objects</a></p></li>
<li><p><a class="reference internal" href="#helpers" id="id26">Helpers</a></p>
<ul>
<li><p><a class="reference internal" href="#waiting-for-events" id="id27">Waiting for events</a></p></li>
<li><p><a class="reference internal" href="#loading-test-data-from-json-files" id="id28">Loading test data from JSON files</a></p></li>
<li><p><a class="reference internal" href="#utility-functions" id="id29">Utility Functions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#deprecated-apis" id="id30">Deprecated APIs</a></p></li>
</ul>
</nav>
<p>testharness.js provides a framework for writing testcases. It is intended to
provide a convenient API for making common assertions, and to work both
for testing synchronous and asynchronous DOM features in a way that
promotes clear, robust, tests.</p>
<section id="markup">
<h2>Markup<a class="headerlink" href="#markup" title="Link to this heading">¶</a></h2>
<p>The test harness script can be used from HTML or SVG documents and workers.</p>
<p>From an HTML or SVG document, start by importing both <code class="docutils literal notranslate"><span class="pre">testharness.js</span></code> and
<code class="docutils literal notranslate"><span class="pre">testharnessreport.js</span></code> scripts into the document:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharness.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharnessreport.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Refer to the <a class="reference external" href="#web-workers">Web Workers</a> section for details and an example on
testing within a web worker.</p>
<p>Within each file one may define one or more tests. Each test is atomic in the
sense that a single test has a single status (<code class="docutils literal notranslate"><span class="pre">PASS</span></code>/<code class="docutils literal notranslate"><span class="pre">FAIL</span></code>/<code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>/<code class="docutils literal notranslate"><span class="pre">NOTRUN</span></code>).
Within each test one may have a number of asserts. The test fails at the first
failing assert, and the remainder of the test is (typically) not run.</p>
<p><strong>Note:</strong> From the point of view of a test harness, each document
using testharness.js is a single “test” and each js-defined
<a class="reference external" href="#Test"><code class="docutils literal notranslate"><span class="pre">Test</span></code></a> is referred to as a “subtest”.</p>
<p>By default tests must be created before the load event fires. For ways
to create tests after the load event, see <a class="reference external" href="#determining-when-all-tests-are-complete">determining when all tests
are complete</a>.</p>
<section id="harness-timeout">
<h3>Harness Timeout<a class="headerlink" href="#harness-timeout" title="Link to this heading">¶</a></h3>
<p>Execution of tests on a page is subject to a global timeout. By
default this is 10s, but a test runner may set a timeout multiplier
which alters the value according to the requirements of the test
environment (e.g. to give a longer timeout for debug builds).</p>
<p>Long-running tests may opt into a longer timeout by providing a
<code class="docutils literal notranslate"><span class="pre">&lt;meta&gt;</span></code> element:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;timeout&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;long&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>By default this increases the timeout to 60s, again subject to the
timeout multiplier.</p>
<p>Tests which define a large number of subtests may need to use the
<a class="reference external" href="testharness.html#specifying-test-variants">variant</a> feature to break
a single test document into several chunks that complete inside the
timeout.</p>
<p>Occasionally tests may have a race between the harness timing out and
a particular test failing; typically when the test waits for some
event that never occurs. In this case it is possible to use
<a class="reference external" href="#Test.force_timeout"><code class="docutils literal notranslate"><span class="pre">Test.force_timeout()</span></code></a> in place of
<a class="reference external" href="#assert_unreached"><code class="docutils literal notranslate"><span class="pre">assert_unreached()</span></code></a>, to immediately fail the
test but with a status of <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>. This should only be used as a
last resort when it is not possible to make the test reliable in some
other way.</p>
</section>
</section>
<section id="defining-tests">
<h2>Defining Tests<a class="headerlink" href="#defining-tests" title="Link to this heading">¶</a></h2>
<section id="synchronous-tests">
<h3>Synchronous Tests<a class="headerlink" href="#synchronous-tests" title="Link to this heading">¶</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="test">
<span class="sig-name descname"><span class="n"><span class="pre">test</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test" title="Link to this definition">¶</a></dt>
<dd><p>Create a synchronous test</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>TestFunction</em>) – Test function. This is executed immediately. If it returns without error, the test status is set to <code class="docutils literal notranslate"><span class="pre">PASS</span></code>. If it throws an <a class="reference internal" href="#AssertionError" title="AssertionError"><code class="xref js js-class docutils literal notranslate"><span class="pre">AssertionError()</span></code></a>, or any other exception, the test status is set to <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> (typically from an <cite>assert</cite> function).</p></li>
<li><p><strong>name</strong> (<em>String</em>) – Test name. This must be unique in a given file and must be invariant between runs.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>A trivial test for the DOM <a class="reference external" href="https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature"><code class="docutils literal notranslate"><span class="pre">hasFeature()</span></code></a>
method (which is defined to always return true) would be:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assert_true</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">implementation</span><span class="p">.</span><span class="nx">hasFeature</span><span class="p">());</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;hasFeature() with no arguments&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="asynchronous-tests">
<h3>Asynchronous Tests<a class="headerlink" href="#asynchronous-tests" title="Link to this heading">¶</a></h3>
<p>Testing asynchronous features is somewhat more complex since the
result of a test may depend on one or more events or other
callbacks. The API provided for testing these features is intended to
be rather low-level but applicable to many situations.</p>
<dl class="js function">
<dt class="sig sig-object js" id="async_test">
<span class="sig-name descname"><span class="n"><span class="pre">async_test</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">funcOrName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#async_test" title="Link to this definition">¶</a></dt>
<dd><p>Create an asynchronous test</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>funcOrName</strong> (<em>TestFunction|string</em>) – Initial step function to call immediately with the test name as an argument (if any), or name of the test.</p></li>
<li><p><strong>name</strong> (<em>String</em>) – Test name (if a test function was provided). This must be unique in a given file and must be invariant between runs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Test</strong> – An object representing the ongoing test.</p>
</dd>
</dl>
</dd></dl>

<p>Create a <a class="reference external" href="#Test"><code class="docutils literal notranslate"><span class="pre">Test</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">async_test</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Code is run as part of the test by calling the <a class="reference external" href="#Test.step"><code class="docutils literal notranslate"><span class="pre">step</span></code></a>
method with a function containing the test
<a class="reference external" href="#assert-functions">assertions</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bubbles should be true&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>When all the steps are complete, the <a class="reference external" href="#Test.done"><code class="docutils literal notranslate"><span class="pre">done</span></code></a> method must
be called:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">async_test</span></code> can also takes a function as first argument.  This
function is called with the test object as both its <code class="docutils literal notranslate"><span class="pre">this</span></code> object and
first argument. The above example can be rewritten as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">async_test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">step</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bubbles should be true&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>In many cases it is convenient to run a step in response to an event or a
callback. A convenient method of doing this is through the <code class="docutils literal notranslate"><span class="pre">step_func</span></code> method
which returns a function that, when called runs a test step. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bubbles should be true&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>As a further convenience, the <code class="docutils literal notranslate"><span class="pre">step_func</span></code> that calls
<a class="reference external" href="#Test.done"><code class="docutils literal notranslate"><span class="pre">done</span></code></a> can instead use
<a class="reference external" href="#Test.step_func_done"><code class="docutils literal notranslate"><span class="pre">step_func_done</span></code></a>, as follows:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func_done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assert_true</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bubbles should be true&quot;</span><span class="p">);</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>For asynchronous callbacks that should never execute,
<a class="reference external" href="#Test.unreached_func"><code class="docutils literal notranslate"><span class="pre">unreached_func</span></code></a> can be used. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">unreached_func</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded should not be fired on the document element&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p><strong>Note:</strong> the <code class="docutils literal notranslate"><span class="pre">testharness.js</span></code> doesn’t impose any scheduling on async
tests; they run whenever the step functions are invoked. This means
multiple tests in the same global can be running concurrently and must
take care not to interfere with each other.</p>
</section>
<section id="promise-tests">
<h3>Promise Tests<a class="headerlink" href="#promise-tests" title="Link to this heading">¶</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="promise_test">
<span class="sig-name descname"><span class="n"><span class="pre">promise_test</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#promise_test" title="Link to this definition">¶</a></dt>
<dd><p>Create a promise test.</p>
<p>Promise tests are tests which are represented by a promise
object. If the promise is fulfilled the test passes, if it’s
rejected the test fails, otherwise the test passes.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>TestFunction</em>) – Test function. This must return a promise. The test is automatically marked as complete once the promise settles.</p></li>
<li><p><strong>name</strong> (<em>String</em>) – Test name. This must be unique in a given file and must be invariant between runs.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">test_function</span></code> is a function that receives a new <a class="reference external" href="#Test">Test</a> as an
argument. It must return a promise. The test completes when the
returned promise settles. The test fails if the returned promise
rejects.</p>
<p>E.g.:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">promise_test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">foo</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;foo should return &#39;foo&#39;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;Simple example&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">foo()</span></code> returns a Promise that resolves with the string
“foo”. The <code class="docutils literal notranslate"><span class="pre">test_function</span></code> passed into <code class="docutils literal notranslate"><span class="pre">promise_test</span></code> invokes <code class="docutils literal notranslate"><span class="pre">foo</span></code> and attaches
a resolve reaction that verifies the returned value.</p>
<p>Note that in the promise chain constructed in <code class="docutils literal notranslate"><span class="pre">test_function</span></code>
assertions don’t need to be wrapped in <a class="reference external" href="#Test.step"><code class="docutils literal notranslate"><span class="pre">step</span></code></a> or
<a class="reference external" href="#Test.step_func"><code class="docutils literal notranslate"><span class="pre">step_func</span></code></a> calls.</p>
<p>It is possible to mix promise tests with callback functions using
<a class="reference external" href="#Test.step"><code class="docutils literal notranslate"><span class="pre">step</span></code></a>. However this tends to produce confusing tests;
it’s recommended to convert any asynchronous behaviour into part of
the promise chain. For example, instead of</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">promise_test</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">assert_true</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bubbles should be true&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">resolve</span><span class="p">();</span>
<span class="w">    </span><span class="p">}));</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Try,</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">promise_test</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resolve</span><span class="p">);</span>
<span class="w">  </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">assert_true</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bubbles should be true&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Note:</strong> Unlike asynchronous tests, testharness.js queues promise
tests so the next test won’t start running until after the previous
promise test finishes. <a class="reference external" href="https://github.com/web-platform-tests/wpt/pull/17924">When mixing promise-based logic and async
steps</a>, the next
test may begin to execute before the returned promise has settled. Use
<a class="reference external" href="#cleanup">add_cleanup</a> to register any necessary cleanup actions such
as resetting global state that need to happen consistently before the
next test starts.</p>
<p>To test that a promise rejects with a specified exception see <a class="reference external" href="#promise-rejection">promise
rejection</a>.</p>
</section>
<section id="single-page-tests">
<h3>Single Page Tests<a class="headerlink" href="#single-page-tests" title="Link to this heading">¶</a></h3>
<p>Sometimes, particularly when dealing with asynchronous behaviour,
having exactly one test per page is desirable, and the overhead of
wrapping everything in functions for isolation becomes
burdensome. For these cases <code class="docutils literal notranslate"><span class="pre">testharness.js</span></code> support “single page
tests”.</p>
<p>In order for a test to be interpreted as a single page test, it should set the
<code class="docutils literal notranslate"><span class="pre">single_test</span></code> <a class="reference external" href="#setup">setup option</a> to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Basic document.body test<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharness.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharnessreport.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="nx">setup</span><span class="p">({</span><span class="w"> </span><span class="nx">single_test</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)[</span><span class="mf">0</span><span class="p">])</span>
<span class="w">    </span><span class="nx">done</span><span class="p">()</span>
<span class="w"> </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The test title for single page tests is always taken from <code class="docutils literal notranslate"><span class="pre">document.title</span></code>.</p>
</section>
</section>
<section id="making-assertions">
<h2>Making assertions<a class="headerlink" href="#making-assertions" title="Link to this heading">¶</a></h2>
<p>Functions for making assertions start <code class="docutils literal notranslate"><span class="pre">assert_</span></code>. The full list of
asserts available is documented in the <a class="reference external" href="#assert-functions">asserts</a>
section. The general signature is:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">assert_something</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span><span class="w"> </span><span class="nx">expected</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">)</span>
</pre></div>
</div>
<p>although not all assertions precisely match this pattern
e.g. <a class="reference external" href="#assert_true"><code class="docutils literal notranslate"><span class="pre">assert_true</span></code></a> only takes <code class="docutils literal notranslate"><span class="pre">actual</span></code> and
<code class="docutils literal notranslate"><span class="pre">description</span></code> as arguments.</p>
<p>The description parameter is used to present more useful error
messages when a test fails.</p>
<p>When assertions are violated, they throw an
<a class="reference external" href="#AssertionError"><code class="docutils literal notranslate"><span class="pre">AssertionError</span></code></a> exception. This interrupts test
execution, so subsequent statements are not evaluated. A given test
can only fail due to one such violation, so if you would like to
assert multiple behaviors independently, you should use multiple
tests.</p>
<p><strong>Note:</strong> Unless the test is a <a class="reference external" href="#single-page-tests">single page test</a>,
assert functions must only be called in the context of a
<a class="reference external" href="#Test"><code class="docutils literal notranslate"><span class="pre">Test</span></code></a>.</p>
<section id="optional-features">
<h3>Optional Features<a class="headerlink" href="#optional-features" title="Link to this heading">¶</a></h3>
<p>If a test depends on a specification or specification feature that is
OPTIONAL (in the <a class="reference external" href="https://tools.ietf.org/html/rfc2119">RFC 2119
sense</a>),
<a class="reference external" href="#assert_implements_optional"><code class="docutils literal notranslate"><span class="pre">assert_implements_optional</span></code></a> can be
used to indicate that failing the test does not mean violating a web
standard. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">async_test</span><span class="p">((</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">video</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">assert_implements_optional</span><span class="p">(</span><span class="nx">video</span><span class="p">.</span><span class="nx">canPlayType</span><span class="p">(</span><span class="s2">&quot;video/webm&quot;</span><span class="p">));</span>
<span class="w">  </span><span class="nx">video</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;multitrack.webm&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// test something specific to multiple audio tracks in a WebM container</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;WebM with multiple audio tracks&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>A failing <a class="reference external" href="#assert_implements_optional"><code class="docutils literal notranslate"><span class="pre">assert_implements_optional</span></code></a>
call is reported as a status of <code class="docutils literal notranslate"><span class="pre">PRECONDITION_FAILED</span></code> for the
subtest. This unusual status code is a legacy leftover; see the <a class="reference external" href="https://github.com/web-platform-tests/rfcs/pull/48">RFC
that introduced
<code class="docutils literal notranslate"><span class="pre">assert_implements_optional</span></code></a>.</p>
<p><a class="reference external" href="#assert_implements_optional"><code class="docutils literal notranslate"><span class="pre">assert_implements_optional</span></code></a> can also
be used during <a class="reference external" href="#setup">test setup</a>. For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">setup</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assert_implements_optional</span><span class="p">(</span><span class="s2">&quot;optionalfeature&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
<span class="w">                             </span><span class="s2">&quot;&#39;optionalfeature&#39; event supported&quot;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">async_test</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* test #1 waiting for &quot;optionalfeature&quot; event */</span><span class="w"> </span><span class="p">});</span>
<span class="nx">async_test</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* test #2 waiting for &quot;optionalfeature&quot; event */</span><span class="w"> </span><span class="p">});</span>
</pre></div>
</div>
<p>A failing <a class="reference external" href="#assert_implements_optional"><code class="docutils literal notranslate"><span class="pre">assert_implements_optional</span></code></a>
during setup is reported as a status of <code class="docutils literal notranslate"><span class="pre">PRECONDITION_FAILED</span></code> for the
test, and the subtests will not run.</p>
<p>See also the <code class="docutils literal notranslate"><span class="pre">.optional</span></code> <a class="reference internal" href="file-names.html"><span class="doc">file name convention</span></a>, which may be
preferable if the entire test is optional.</p>
</section>
</section>
<section id="testing-across-globals">
<h2>Testing Across Globals<a class="headerlink" href="#testing-across-globals" title="Link to this heading">¶</a></h2>
<section id="consolidating-tests-from-other-documents">
<h3>Consolidating tests from other documents<a class="headerlink" href="#consolidating-tests-from-other-documents" title="Link to this heading">¶</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="fetch_tests_from_window">
<span class="sig-name descname"><span class="n"><span class="pre">fetch_tests_from_window</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">window</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fetch_tests_from_window" title="Link to this definition">¶</a></dt>
<dd><p>Aggregate tests from separate windows or iframes
into the current document as if they were all part of the same test file.</p>
<p>The document of the second window (or iframe) should include
<code class="docutils literal notranslate"><span class="pre">testharness.js</span></code>, but not <code class="docutils literal notranslate"><span class="pre">testharnessreport.js</span></code>, and use
<a class="reference internal" href="#test" title="test"><code class="xref js js-func docutils literal notranslate"><span class="pre">test()</span></code></a>, <a class="reference internal" href="#async_test" title="async_test"><code class="xref js js-func docutils literal notranslate"><span class="pre">async_test()</span></code></a>, and <a class="reference internal" href="#promise_test" title="promise_test"><code class="xref js js-func docutils literal notranslate"><span class="pre">promise_test()</span></code></a> in
the usual manner.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>window</strong> (<em>Window</em>) – The window to fetch tests from.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p><strong>Note:</strong> By default any markup file referencing <code class="docutils literal notranslate"><span class="pre">testharness.js</span></code> will
be detected as a test. To avoid this, it must be put in a <code class="docutils literal notranslate"><span class="pre">support</span></code>
directory.</p>
<p>The current test suite will not report completion until all fetched
tests are complete, and errors in the child contexts will result in
failures for the suite in the current context.</p>
<p>Here’s an example that uses <code class="docutils literal notranslate"><span class="pre">window.open</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">support/child.html</span></code>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Child context test(s)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharness.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;log&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">assert_true</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;true is true&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;Simple test&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">test.html</span></code>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Primary test context<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharness.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharnessreport.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;log&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">child_window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;support/child.html&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">fetch_tests_from_window</span><span class="p">(</span><span class="nx">child_window</span><span class="p">);</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="web-workers">
<h3>Web Workers<a class="headerlink" href="#web-workers" title="Link to this heading">¶</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="fetch_tests_from_worker">
<span class="sig-name descname"><span class="n"><span class="pre">fetch_tests_from_worker</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">port</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fetch_tests_from_worker" title="Link to this definition">¶</a></dt>
<dd><p>Get test results from a worker and include them in the current test.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>port</strong> (<em>Worker|SharedWorker|ServiceWorker|MessagePort</em>) – Either a worker object or a port connected to a worker which is running tests..</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Promise</strong> – - A promise that’s resolved once all the remote tests are complete.</p>
</dd>
</dl>
</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">testharness.js</span></code> script can be used from within <a class="reference external" href="https://html.spec.whatwg.org/multipage/workers.html">dedicated workers, shared
workers</a> and <a class="reference external" href="https://w3c.github.io/ServiceWorker/">service
workers</a>.</p>
<p>Testing from a worker script is different from testing from an HTML document in
several ways:</p>
<ul class="simple">
<li><p>Workers have no reporting capability since they are running in the background.
Hence they rely on <code class="docutils literal notranslate"><span class="pre">testharness.js</span></code> running in a companion client HTML document
for reporting.</p></li>
<li><p>Shared and service workers do not have a unique client document
since there could be more than one document that communicates with
these workers. So a client document needs to explicitly connect to a
worker and fetch test results from it using
<a class="reference external" href="#fetch_tests_from_worker"><code class="docutils literal notranslate"><span class="pre">fetch_tests_from_worker</span></code></a>. This is true
even for a dedicated worker. Once connected, the individual tests
running in the worker (or those that have already run to completion)
will be automatically reflected in the client document.</p></li>
<li><p>The client document controls the timeout of the tests. All worker
scripts act as if they were started with the
<a class="reference external" href="#setup"><code class="docutils literal notranslate"><span class="pre">explicit_timeout</span></code></a> option.</p></li>
<li><p>Dedicated and shared workers don’t have an equivalent of an <code class="docutils literal notranslate"><span class="pre">onload</span></code>
event.  Thus the test harness has no way to know when all tests have
completed (see <a class="reference external" href="#determining-when-all-tests-are-complete">Determining when all tests are
complete</a>). So these
worker tests behave as if they were started with the
<a class="reference external" href="#setup"><code class="docutils literal notranslate"><span class="pre">explicit_done</span></code></a> option. Service workers depend on the
<a class="reference external" href="https://w3c.github.io/ServiceWorker/#service-worker-global-scope-install-event">oninstall</a>
event and don’t require an explicit <a class="reference external" href="#done"><code class="docutils literal notranslate"><span class="pre">done</span></code></a> call.</p></li>
</ul>
<p>Here’s an example that uses a dedicated worker.</p>
<p><code class="docutils literal notranslate"><span class="pre">worker.js</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">importScripts</span><span class="p">(</span><span class="s2">&quot;/resources/testharness.js&quot;</span><span class="p">);</span>

<span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assert_true</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;true is true&quot;</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;Simple test&quot;</span><span class="p">);</span>

<span class="c1">// done() is needed because the testharness is running as if explicit_done</span>
<span class="c1">// was specified.</span>
<span class="nx">done</span><span class="p">();</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">test.html</span></code>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Simple test<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharness.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resources/testharnessreport.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;log&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="nx">fetch_tests_from_worker</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Worker</span><span class="p">(</span><span class="s2">&quot;worker.js&quot;</span><span class="p">));</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fetch_tests_from_worker</span></code> returns a promise that resolves once all the remote
tests have completed. This is useful if you’re importing tests from multiple
workers and want to ensure they run in series:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch_tests_from_worker</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Worker</span><span class="p">(</span><span class="s2">&quot;worker-1.js&quot;</span><span class="p">));</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch_tests_from_worker</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Worker</span><span class="p">(</span><span class="s2">&quot;worker-2.js&quot;</span><span class="p">));</span>
<span class="p">})();</span>
</pre></div>
</div>
</section>
</section>
<section id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Link to this heading">¶</a></h2>
<p>Occasionally tests may create state that will persist beyond the test
itself.  In order to ensure that tests are independent, such state
should be cleaned up once the test has a result. This can be achieved
by adding cleanup callbacks to the test. Such callbacks are registered
using the <a class="reference external" href="#Test.add_cleanup"><code class="docutils literal notranslate"><span class="pre">add_cleanup</span></code></a> method. All registered
callbacks will be run as soon as the test result is known. For
example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nx">test</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">element</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;null&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">add_cleanup</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="nx">element</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;Calling document.getElementById with a null argument.&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>If the test was created using the <a class="reference external" href="#promise_test"><code class="docutils literal notranslate"><span class="pre">promise_test</span></code></a> API,
then cleanup functions may optionally return a Promise and delay the
completion of the test until all cleanup promises have settled.</p>
<p>All callbacks will be invoked synchronously; tests that require more
complex cleanup behavior should manage execution order explicitly. If
any of the eventual values are rejected, the test runner will report
an error.</p>
<section id="abortsignal-support">
<h3>AbortSignal support<a class="headerlink" href="#abortsignal-support" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="#Test.get_signal"><code class="docutils literal notranslate"><span class="pre">Test.get_signal</span></code></a> gives an AbortSignal that is aborted when
the test finishes. This can be useful when dealing with AbortSignal-supported
APIs.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">promise_test</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Throws when the user agent does not support AbortSignal</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">signal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">get_signal</span><span class="p">();</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">once</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">signal</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;click&quot;</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="timers-in-tests">
<h2>Timers in Tests<a class="headerlink" href="#timers-in-tests" title="Link to this heading">¶</a></h2>
<p>In general the use of timers (i.e. <code class="docutils literal notranslate"><span class="pre">setTimeout</span></code>) in tests is
discouraged because this is an observed source of instability on test
running in CI. In particular if a test should fail when
something doesn’t happen, it is good practice to simply let the test
run to the full timeout rather than trying to guess an appropriate
shorter timeout to use.</p>
<p>In other cases it may be necessary to use a timeout (e.g., for a test
that only passes if some event is <em>not</em> fired). In this case it is
<em>not</em> permitted to use the standard <code class="docutils literal notranslate"><span class="pre">setTimeout</span></code> function. Instead use
either <a class="reference external" href="#Test.step_wait"><code class="docutils literal notranslate"><span class="pre">Test.step_wait()</span></code></a>,
<a class="reference external" href="#Test.step_wait_func"><code class="docutils literal notranslate"><span class="pre">Test.step_wait_func()</span></code></a>, or
<a class="reference external" href="#Test.step_timeout"><code class="docutils literal notranslate"><span class="pre">Test.step_timeout()</span></code></a>. <a class="reference external" href="#Test.step_wait"><code class="docutils literal notranslate"><span class="pre">Test.step_wait()</span></code></a>
and <a class="reference external" href="#Test.step_wait_func"><code class="docutils literal notranslate"><span class="pre">Test.step_wait_func()</span></code></a> are preferred
when there’s a specific condition that needs to be met for the test to
proceed. <a class="reference external" href="#Test.step_timeout"><code class="docutils literal notranslate"><span class="pre">Test.step_timeout()</span></code></a> is preferred in other cases.</p>
<p>Note that timeouts generally need to be a few seconds long in order to
produce stable results in all test environments. However, the use of timeouts should be avoided whenever possible in favor of event-driven approaches. Prefer to wait for an event (e.g., <code class="docutils literal notranslate"><span class="pre">load</span></code>, <code class="docutils literal notranslate"><span class="pre">DOMContentLoaded</span></code>, or custom events) to indicate readiness, or use two <code class="docutils literal notranslate"><span class="pre">requestAnimationFrame</span></code> calls to ensure rendering steps have completed. These alternatives improve reliability and consistency across different environments.</p>
<p>In some cases, such as reftests that compare frames after a specific animation duration (e.g., APNG tests), use of <code class="docutils literal notranslate"><span class="pre">step_timeout()</span></code> may be acceptable. When doing so, consider documenting the reason.
For <a class="reference external" href="#single-page-tests">single page tests</a>,
<a class="reference external" href="#step_timeout">step_timeout</a> is also available as a global function.</p>
<dl class="js function">
<dt class="sig sig-object js" id="step_timeout">
<span class="sig-name descname"><span class="n"><span class="pre">step_timeout</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#step_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Global version of <a class="reference internal" href="#Test.step_timeout" title="Test.step_timeout"><code class="xref js js-func docutils literal notranslate"><span class="pre">Test.step_timeout()</span></code></a> for use in single page tests.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>function</em>) – Function to run after the timeout</p></li>
<li><p><strong>timeout</strong> (<em>number</em>) – Time in ms to wait before running the test step. The actual wait time is <code class="docutils literal notranslate"><span class="pre">timeout</span></code> x <code class="docutils literal notranslate"><span class="pre">timeout_multiplier</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="harness-configuration">
<h2>Harness Configuration<a class="headerlink" href="#harness-configuration" title="Link to this heading">¶</a></h2>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Link to this heading">¶</a></h3>
<!-- sphinx-js doesn't support documenting types so we have to copy in
     the SettingsObject documentation by hand --><dl class="js function">
<dt class="sig sig-object js" id="setup">
<span class="sig-name descname"><span class="n"><span class="pre">setup</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">funcOrProperties</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maybeProperties</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#setup" title="Link to this definition">¶</a></dt>
<dd><p>Configure the harness</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>funcOrProperties</strong> (<em>function|SettingsObject</em>) – Either a setup function to run, or a set of properties. If this is a function that function is run synchronously. Any exception in the function will set the overall harness status to <cite>ERROR</cite>.</p></li>
<li><p><strong>maybeProperties</strong> (<em>SettingsObject</em>) – An object containing the settings to use, if the first argument is a function.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="promise_setup">
<span class="sig-name descname"><span class="n"><span class="pre">promise_setup</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#promise_setup" title="Link to this definition">¶</a></dt>
<dd><p>Configure the harness, waiting for a promise to resolve
before running any <cite>promise_test</cite> tests.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>function</em>) – Function returning a promise that’s run synchronously. Promise tests are not run until after this function has resolved.</p></li>
<li><p><strong>properties</strong> (<em>SettingsObject</em>) – An object containing the harness settings to use.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="field-list simple">
<dt class="field-odd">SettingsObject<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="field-list simple">
<dt class="field-odd">Properties<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>single_test</strong> (<em>bool</em>) - Use the single-page-test mode. In this
mode the Document represents a single <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a>. Asserts may be
used directly without requiring <a class="reference internal" href="#Test.step" title="Test.step"><code class="xref js js-func docutils literal notranslate"><span class="pre">Test.step()</span></code></a> or similar wrappers,
and any exceptions set the status of the test rather than the status
of the harness.</p></li>
<li><p><strong>allow_uncaught_exception</strong> (<em>bool</em>) - don’t treat an
uncaught exception as an error; needed when e.g. testing the
<cite>window.onerror</cite> handler.</p></li>
<li><p><strong>explicit_done</strong> (<em>bool</em>) - Wait for a call to <a class="reference internal" href="#done" title="done"><code class="xref js js-func docutils literal notranslate"><span class="pre">done()</span></code></a>
before declaring all tests complete (this is always true for
single-page tests).</p></li>
<li><p><strong>hide_test_state</strong> (<em>bool</em>) - hide the test state output while
the test is running; This is helpful when the output of the test state
may interfere the test results.</p></li>
<li><p><strong>explicit_timeout</strong> (<em>bool</em>)  - disable file timeout; only
stop waiting for results when the <a class="reference internal" href="#timeout" title="timeout"><code class="xref js js-func docutils literal notranslate"><span class="pre">timeout()</span></code></a> function is
called. This should typically only be set for manual tests, or
by a test runner that provides its own timeout mechanism.</p></li>
<li><p><strong>timeout_multiplier</strong> (<em>Number</em>) - Multiplier to apply to
timeouts. This should only be set by a test runner.</p></li>
<li><p><strong>output</strong> (<em>bool</em>) - (default: <cite>true</cite>) Whether to output a table
containing a summary of test results. This should typically
only be set by a test runner, and is typically set to false
for performance reasons when running in CI.</p></li>
<li><p><strong>output_document</strong> (<em>Document</em>) output_document - The document to which
results should be logged. By default this is the current
document but could be an ancestor document in some cases e.g. a
SVG test loaded in an HTML wrapper</p></li>
<li><p><strong>debug</strong> (<em>bool</em>) - (default: <cite>false</cite>) Whether to output
additional debugging information such as a list of
asserts. This should typically only be set by a test runner.</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Link to this heading">¶</a></h3>
<p>If the file containing the tests is a HTML file, a table containing
the test results will be added to the document after all tests have
run. By default this will be added to a <code class="docutils literal notranslate"><span class="pre">div</span></code> element with <code class="docutils literal notranslate"><span class="pre">id=log</span></code> if
it exists, or a new <code class="docutils literal notranslate"><span class="pre">div</span></code> element appended to <code class="docutils literal notranslate"><span class="pre">document.body</span></code> if it
does not. This can be suppressed by setting the <a class="reference external" href="#setup"><code class="docutils literal notranslate"><span class="pre">output</span></code></a>
setting to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>If <a class="reference external" href="#setup"><code class="docutils literal notranslate"><span class="pre">output</span></code></a> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, the test will, by default, report
progress during execution. In some cases this progress report will
invalidate the test. In this case the test should set the
<a class="reference external" href="#setup"><code class="docutils literal notranslate"><span class="pre">hide_test_state</span></code></a> setting to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</section>
<section id="determining-when-all-tests-are-complete">
<h3>Determining when all tests are complete<a class="headerlink" href="#determining-when-all-tests-are-complete" title="Link to this heading">¶</a></h3>
<p>By default, tests running in a <code class="docutils literal notranslate"><span class="pre">WindowGlobalScope</span></code>, which are not
configured as a <a class="reference external" href="#single-page-tests">single page test</a> the test
harness will assume there are no more results to come when:</p>
<ol class="simple">
<li><p>There are no <code class="docutils literal notranslate"><span class="pre">Test</span></code> objects that have been created but not completed</p></li>
<li><p>The load event on the document has fired</p></li>
</ol>
<p>For single page tests, or when the <code class="docutils literal notranslate"><span class="pre">explicit_done</span></code> property has been
set in the <a class="reference external" href="#setup">setup</a>, the <a class="reference external" href="#done"><code class="docutils literal notranslate"><span class="pre">done</span></code></a> function must be used.</p>
<dl class="js function">
<dt class="sig sig-object js" id="done">
<span class="sig-name descname"><span class="n"><span class="pre">done</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#done" title="Link to this definition">¶</a></dt>
<dd><p>Mark test loading as complete.</p>
<p>Typically this function is called implicitly on page load; it’s
only necessary for users to call this when either the
<code class="docutils literal notranslate"><span class="pre">explicit_done</span></code> or <code class="docutils literal notranslate"><span class="pre">single_test</span></code> properties have been set
via the <a class="reference internal" href="#setup" title="setup"><code class="xref js js-func docutils literal notranslate"><span class="pre">setup()</span></code></a> function.</p>
<p>For single page tests this marks the test as complete and sets its status.
For other tests, this marks test loading as complete, but doesn’t affect ongoing tests.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="timeout">
<span class="sig-name descname"><span class="n"><span class="pre">timeout</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#timeout" title="Link to this definition">¶</a></dt>
<dd><p>Timeout the tests.</p>
<p>This only has an effect when <code class="docutils literal notranslate"><span class="pre">explicit_timeout</span></code> has been set
in <a class="reference internal" href="#setup" title="setup"><code class="xref js js-func docutils literal notranslate"><span class="pre">setup()</span></code></a>. In other cases any call is a no-op.</p>
</dd></dl>

<p>Dedicated and shared workers don’t have an event that corresponds to
the <code class="docutils literal notranslate"><span class="pre">load</span></code> event in a document. Therefore these worker tests always
behave as if the <code class="docutils literal notranslate"><span class="pre">explicit_done</span></code> property is set to true (unless they
are defined using <a class="reference external" href="testharness.html#multi-global-tests">the “multi-global”
pattern</a>). Service workers depend
on the
<a class="reference external" href="https://w3c.github.io/ServiceWorker/#service-worker-global-scope-install-event">install</a>
event which is fired following the completion of <a class="reference external" href="https://html.spec.whatwg.org/multipage/workers.html#run-a-worker">running the
worker</a>.</p>
</section>
</section>
<section id="reporting-api">
<h2>Reporting API<a class="headerlink" href="#reporting-api" title="Link to this heading">¶</a></h2>
<section id="callbacks">
<h3>Callbacks<a class="headerlink" href="#callbacks" title="Link to this heading">¶</a></h3>
<p>The framework provides callbacks corresponding to 4 events:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> - triggered when the first Test is created</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_state</span></code> - triggered when a test state changes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code> - triggered when a test result is received</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">complete</span></code> - triggered when all results are received</p></li>
</ul>
<dl class="js function">
<dt class="sig sig-object js" id="add_start_callback">
<span class="sig-name descname"><span class="n"><span class="pre">add_start_callback</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#add_start_callback" title="Link to this definition">¶</a></dt>
<dd><p>Add a callback that’s triggered when the first <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> is created.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>callback</strong> (<em>function</em>) – Callback function. This is called without arguments.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="add_test_state_callback">
<span class="sig-name descname"><span class="n"><span class="pre">add_test_state_callback</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#add_test_state_callback" title="Link to this definition">¶</a></dt>
<dd><p>Add a callback that’s triggered when a test state changes.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>callback</strong> (<em>function</em>) – Callback function, called with the <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> as the only argument.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="add_result_callback">
<span class="sig-name descname"><span class="n"><span class="pre">add_result_callback</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#add_result_callback" title="Link to this definition">¶</a></dt>
<dd><p>Add a callback that’s triggered when a test result is received.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>callback</strong> (<em>function</em>) – Callback function, called with the <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> as the only argument.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="add_completion_callback">
<span class="sig-name descname"><span class="n"><span class="pre">add_completion_callback</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#add_completion_callback" title="Link to this definition">¶</a></dt>
<dd><p>Add a callback that’s triggered when all tests are complete.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>callback</strong> (<em>function</em>) – Callback function, called with an array of <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> objects, a <a class="reference internal" href="#TestsStatus" title="TestsStatus"><code class="xref js js-class docutils literal notranslate"><span class="pre">TestsStatus()</span></code></a> object and an array of <a class="reference internal" href="#AssertRecord" title="AssertRecord"><code class="xref js js-class docutils literal notranslate"><span class="pre">AssertRecord()</span></code></a> objects. If the debug setting is <code class="docutils literal notranslate"><span class="pre">false</span></code> the final argument will be an empty array. For performance reasons asserts are only tracked when the debug setting is <code class="docutils literal notranslate"><span class="pre">true</span></code>. In other cases the array of asserts will be empty.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js class">
<dt class="sig sig-object js" id="TestsStatus">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">TestsStatus</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TestsStatus" title="Link to this definition">¶</a></dt>
<dd><p>Status of the overall harness</p>
<dl class="js attribute">
<dt class="sig sig-object js" id="TestsStatus.message">
<span class="sig-prename descclassname"><span class="n"><span class="pre">TestsStatus</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">message</span></span></span><a class="headerlink" href="#TestsStatus.message" title="Link to this definition">¶</a></dt>
<dd><p>Message in case of failure</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="TestsStatus.stack">
<span class="sig-prename descclassname"><span class="n"><span class="pre">TestsStatus</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">stack</span></span></span><a class="headerlink" href="#TestsStatus.stack" title="Link to this definition">¶</a></dt>
<dd><p>Stack trace in case of an exception.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="TestsStatus.status">
<span class="sig-prename descclassname"><span class="n"><span class="pre">TestsStatus</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">status</span></span></span><a class="headerlink" href="#TestsStatus.status" title="Link to this definition">¶</a></dt>
<dd><p>The status code</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="TestsStatus.statuses">
<span class="sig-prename descclassname"><span class="n"><span class="pre">TestsStatus</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">statuses</span></span></span><a class="headerlink" href="#TestsStatus.statuses" title="Link to this definition">¶</a></dt>
<dd><p>Enum of possible harness statuses.</p>
<dl class="field-list simple">
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PRECONDITION_FAILED</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="js class">
<dt class="sig sig-object js" id="AssertRecord">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">AssertRecord</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assert_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#AssertRecord" title="Link to this definition">¶</a></dt>
<dd><p>Record of an assert that ran.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> (<a class="reference internal" href="#Test" title="Test"><em>Test</em></a>) – The test which ran the assert.</p></li>
<li><p><strong>assert_name</strong> (<em>string</em>) – The function name of the assert.</p></li>
<li><p><strong>args</strong> (<em>Any</em>) – The arguments passed to the assert function.</p></li>
</ul>
</dd>
</dl>
<dl class="js attribute">
<dt class="sig sig-object js" id="AssertRecord.args">
<span class="sig-prename descclassname"><span class="n"><span class="pre">AssertRecord</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">args</span></span></span><a class="headerlink" href="#AssertRecord.args" title="Link to this definition">¶</a></dt>
<dd><p>Stringification of the arguments that were passed to the assert function</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="AssertRecord.assert_name">
<span class="sig-prename descclassname"><span class="n"><span class="pre">AssertRecord</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">assert_name</span></span></span><a class="headerlink" href="#AssertRecord.assert_name" title="Link to this definition">¶</a></dt>
<dd><p>Name of the assert that ran</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="AssertRecord.status">
<span class="sig-prename descclassname"><span class="n"><span class="pre">AssertRecord</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">status</span></span></span><a class="headerlink" href="#AssertRecord.status" title="Link to this definition">¶</a></dt>
<dd><p>Status of the assert</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="AssertRecord.test">
<span class="sig-prename descclassname"><span class="n"><span class="pre">AssertRecord</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">test</span></span></span><a class="headerlink" href="#AssertRecord.test" title="Link to this definition">¶</a></dt>
<dd><p>Test that ran the assert</p>
</dd></dl>

</dd></dl>

</section>
<section id="external-api">
<h3>External API<a class="headerlink" href="#external-api" title="Link to this heading">¶</a></h3>
<p>In order to collect the results of multiple pages containing tests, the test
harness will, when loaded in a nested browsing context, attempt to call
certain functions in each ancestor and opener browsing context:</p>
<ul class="simple">
<li><p>start - <code class="docutils literal notranslate"><span class="pre">start_callback</span></code></p></li>
<li><p>test_state - <code class="docutils literal notranslate"><span class="pre">test_state_callback</span></code></p></li>
<li><p>result - <code class="docutils literal notranslate"><span class="pre">result_callback</span></code></p></li>
<li><p>complete - <code class="docutils literal notranslate"><span class="pre">completion_callback</span></code></p></li>
</ul>
<p>These are given the same arguments as the corresponding internal callbacks
described above.</p>
<p>The test harness will also send messages using cross-document
messaging to each ancestor and opener browsing context. Since it uses the
wildcard keyword (*), cross-origin communication is enabled and script on
different origins can collect the results.</p>
<p>This API follows similar conventions as those described above only slightly
modified to accommodate message event API. Each message is sent by the harness
is passed a single vanilla object, available as the <code class="docutils literal notranslate"><span class="pre">data</span></code> property of the event
object. These objects are structured as follows:</p>
<ul class="simple">
<li><p>start - <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">type:</span> <span class="pre">&quot;start&quot;</span> <span class="pre">}</span></code></p></li>
<li><p>test_state - <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">type:</span> <span class="pre">&quot;test_state&quot;,</span> <span class="pre">test:</span> <span class="pre">Test</span> <span class="pre">}</span></code></p></li>
<li><p>result - <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">type:</span> <span class="pre">&quot;result&quot;,</span> <span class="pre">test:</span> <span class="pre">Test</span> <span class="pre">}</span></code></p></li>
<li><p>complete - <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">type:</span> <span class="pre">&quot;complete&quot;,</span> <span class="pre">tests:</span> <span class="pre">[Test,</span> <span class="pre">...],</span> <span class="pre">status:</span> <span class="pre">TestsStatus</span> <span class="pre">}</span></code></p></li>
</ul>
</section>
</section>
<section id="assert-functions">
<h2>Assert Functions<a class="headerlink" href="#assert-functions" title="Link to this heading">¶</a></h2>
<dl class="js function">
<dt class="sig sig-object js" id="assert_true">
<span class="sig-name descname"><span class="n"><span class="pre">assert_true</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_true" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is strictly true</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>Any</em>) – Value that is asserted to be true</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_false">
<span class="sig-name descname"><span class="n"><span class="pre">assert_false</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_false" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is strictly false</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>Any</em>) – Value that is asserted to be false</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_equals">
<span class="sig-name descname"><span class="n"><span class="pre">assert_equals</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_equals" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is the same value as <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<p>For objects this compares by object identity; for primitives
this distinguishes between 0 and -0, and has correct handling
of NaN.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>Any</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>Any</em>) – Expected value.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_not_equals">
<span class="sig-name descname"><span class="n"><span class="pre">assert_not_equals</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_not_equals" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is not the same value as <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<p>Comparison is as for <a class="reference internal" href="#assert_equals" title="assert_equals"><code class="xref js js-func docutils literal notranslate"><span class="pre">assert_equals()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>Any</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>Any</em>) – The value <code class="docutils literal notranslate"><span class="pre">actual</span></code> is expected to be different to.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_in_array">
<span class="sig-name descname"><span class="n"><span class="pre">assert_in_array</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_in_array" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">expected</span></code> is an array and <code class="docutils literal notranslate"><span class="pre">actual</span></code> is one of the members.
This is implemented using <code class="docutils literal notranslate"><span class="pre">indexOf</span></code>, so doesn’t handle NaN or ±0 correctly.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>Any</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>Array</em>) – An array that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is expected to be a member of.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_array_equals">
<span class="sig-name descname"><span class="n"><span class="pre">assert_array_equals</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_array_equals" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> and <code class="docutils literal notranslate"><span class="pre">expected</span></code> are both arrays, and that the array properties of
<code class="docutils literal notranslate"><span class="pre">actual</span></code> and <code class="docutils literal notranslate"><span class="pre">expected</span></code> are all the same value (as for <a class="reference internal" href="#assert_equals" title="assert_equals"><code class="xref js js-func docutils literal notranslate"><span class="pre">assert_equals()</span></code></a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>Array</em>) – Test array.</p></li>
<li><p><strong>expected</strong> (<em>Array</em>) – Array that is expected to contain the same values as <code class="docutils literal notranslate"><span class="pre">actual</span></code>.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_approx_equals">
<span class="sig-name descname"><span class="n"><span class="pre">assert_approx_equals</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_approx_equals" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is within ± <code class="docutils literal notranslate"><span class="pre">epsilon</span></code> of <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>number</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>number</em>) – Value number is expected to be close to.</p></li>
<li><p><strong>epsilon</strong> (<em>number</em>) – Magnitude of allowed difference between <code class="docutils literal notranslate"><span class="pre">actual</span></code> and <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_array_approx_equals">
<span class="sig-name descname"><span class="n"><span class="pre">assert_array_approx_equals</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_array_approx_equals" title="Link to this definition">¶</a></dt>
<dd><p>Assert that each array property in <code class="docutils literal notranslate"><span class="pre">actual</span></code> is a number within
± <cite>epsilon</cite> of the corresponding property in <cite>expected</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>Array</em>) – Array of test values.</p></li>
<li><p><strong>expected</strong> (<em>Array</em>) – Array of values expected to be close to the values in <code class="docutils literal notranslate"><span class="pre">actual</span></code>.</p></li>
<li><p><strong>epsilon</strong> (<em>number</em>) – Magnitude of allowed difference between each value in <code class="docutils literal notranslate"><span class="pre">actual</span></code> and <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_less_than">
<span class="sig-name descname"><span class="n"><span class="pre">assert_less_than</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_less_than" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is a number less than <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>number|bigint</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be less than.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_greater_than">
<span class="sig-name descname"><span class="n"><span class="pre">assert_greater_than</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_greater_than" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is a number greater than <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>number|bigint</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be greater than.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_between_exclusive">
<span class="sig-name descname"><span class="n"><span class="pre">assert_between_exclusive</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_between_exclusive" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is a number greater than <code class="docutils literal notranslate"><span class="pre">lower</span></code> and less
than <code class="docutils literal notranslate"><span class="pre">upper</span></code> but not equal to either.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>number|bigint</em>) – Test value.</p></li>
<li><p><strong>lower</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be greater than.</p></li>
<li><p><strong>upper</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be less than.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_less_than_equal">
<span class="sig-name descname"><span class="n"><span class="pre">assert_less_than_equal</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_less_than_equal" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is a number less than or equal to <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>number|bigint</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be less than or equal to.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_greater_than_equal">
<span class="sig-name descname"><span class="n"><span class="pre">assert_greater_than_equal</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_greater_than_equal" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is a number greater than or equal to <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>number|bigint</em>) – Test value.</p></li>
<li><p><strong>expected</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be greater than or equal to.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_between_inclusive">
<span class="sig-name descname"><span class="n"><span class="pre">assert_between_inclusive</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_between_inclusive" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> is a number greater than or equal to <code class="docutils literal notranslate"><span class="pre">lower</span></code> and less
than or equal to <code class="docutils literal notranslate"><span class="pre">upper</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>number|bigint</em>) – Test value.</p></li>
<li><p><strong>lower</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be greater than or equal to.</p></li>
<li><p><strong>upper</strong> (<em>number|bigint</em>) – Value that <code class="docutils literal notranslate"><span class="pre">actual</span></code> must be less than or equal to.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_regexp_match">
<span class="sig-name descname"><span class="n"><span class="pre">assert_regexp_match</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_regexp_match" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">actual</span></code> matches the RegExp <code class="docutils literal notranslate"><span class="pre">expected</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>actual</strong> (<em>String</em>) – Test string.</p></li>
<li><p><strong>expected</strong> (<em>RegExp</em>) – RegExp <code class="docutils literal notranslate"><span class="pre">actual</span></code> must match.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_class_string">
<span class="sig-name descname"><span class="n"><span class="pre">assert_class_string</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">class_string</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_class_string" title="Link to this definition">¶</a></dt>
<dd><p>Assert that the class string of <code class="docutils literal notranslate"><span class="pre">object</span></code> as returned in
<code class="docutils literal notranslate"><span class="pre">Object.prototype.toString</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">class_name</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> (<em>Object</em>) – Object to stringify.</p></li>
<li><p><strong>class_string</strong> (<em>string</em>) – Expected class string for <code class="docutils literal notranslate"><span class="pre">object</span></code>.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_own_property">
<span class="sig-name descname"><span class="n"><span class="pre">assert_own_property</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_own_property" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">object</span></code> has an own property with name <code class="docutils literal notranslate"><span class="pre">property_name</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> (<em>Object</em>) – Object that should have the given property.</p></li>
<li><p><strong>property_name</strong> (<em>string</em>) – Expected property name.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_not_own_property">
<span class="sig-name descname"><span class="n"><span class="pre">assert_not_own_property</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_not_own_property" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">object</span></code> does not have an own property with name <code class="docutils literal notranslate"><span class="pre">property_name</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> (<em>Object</em>) – Object that should not have the given property.</p></li>
<li><p><strong>property_name</strong> (<em>string</em>) – Property name to test.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_inherits">
<span class="sig-name descname"><span class="n"><span class="pre">assert_inherits</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_inherits" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">object</span></code> does not have an own property with name
<code class="docutils literal notranslate"><span class="pre">property_name</span></code>, but inherits one through the prototype chain.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> (<em>Object</em>) – Object that should have the given property in its prototype chain.</p></li>
<li><p><strong>property_name</strong> (<em>string</em>) – Expected property name.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_idl_attribute">
<span class="sig-name descname"><span class="n"><span class="pre">assert_idl_attribute</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_idl_attribute" title="Link to this definition">¶</a></dt>
<dd><p>Alias for <code class="xref js js-func docutils literal notranslate"><span class="pre">insert_inherits()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> (<em>Object</em>) – Object that should have the given property in its prototype chain.</p></li>
<li><p><strong>property_name</strong> (<em>string</em>) – Expected property name.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_readonly">
<span class="sig-name descname"><span class="n"><span class="pre">assert_readonly</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">property_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_readonly" title="Link to this definition">¶</a></dt>
<dd><p>Assert that <code class="docutils literal notranslate"><span class="pre">object</span></code> has a property named <code class="docutils literal notranslate"><span class="pre">property_name</span></code> and that the property is not writable or has no setter.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> (<em>Object</em>) – Object that should have the given (not necessarily own) property.</p></li>
<li><p><strong>property_name</strong> (<em>string</em>) – Expected property name.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_throws_dom">
<span class="sig-name descname"><span class="n"><span class="pre">assert_throws_dom</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">descriptionOrFunc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_throws_dom" title="Link to this definition">¶</a></dt>
<dd><p>Assert a DOMException with the expected type is thrown.</p>
<p>There are two ways of calling assert_throws_dom:</p>
<p>1) If the DOMException is expected to come from the current global, the
second argument should be the function expected to throw and a third,
optional, argument is the assertion description.</p>
<p>2) If the DOMException is expected to come from some other global, the
second argument should be the DOMException constructor from that global,
the third argument the function expected to throw, and the fourth, optional,
argument the assertion description.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<em>number|string</em>) – The expected exception name or code.  See the <a class="reference external" href="https://webidl.spec.whatwg.org/#dfn-error-names-table">table of names and codes</a>. If a number is passed it should be one of the numeric code values in that table (e.g. 3, 4, etc).  If a string is passed it can either be an exception name (e.g. “HierarchyRequestError”, “WrongDocumentError”) or the name of the corresponding error code (e.g. “<code class="docutils literal notranslate"><span class="pre">HIERARCHY_REQUEST_ERR</span></code>”, “<code class="docutils literal notranslate"><span class="pre">WRONG_DOCUMENT_ERR</span></code>”).</p></li>
<li><p><strong>descriptionOrFunc</strong> (<em>function</em>) – The function expected to throw (if the exception comes from another global), or the optional description of the condition being tested (if the exception comes from the current global).</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested (if the exception comes from another global).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_throws_js">
<span class="sig-name descname"><span class="n"><span class="pre">assert_throws_js</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constructor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_throws_js" title="Link to this definition">¶</a></dt>
<dd><p>Assert a JS Error with the expected constructor is thrown.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>constructor</strong> (<em>object</em>) – The expected exception constructor.</p></li>
<li><p><strong>func</strong> (<em>function</em>) – Function which should throw.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error description for the case that the error is not thrown.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_throws_exactly">
<span class="sig-name descname"><span class="n"><span class="pre">assert_throws_exactly</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exception</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_throws_exactly" title="Link to this definition">¶</a></dt>
<dd><p>Assert the provided value is thrown.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>exception</strong> (<em>value</em>) – The expected exception.</p></li>
<li><p><strong>func</strong> (<em>function</em>) – Function which should throw.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error description for the case that the error is not thrown.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_implements">
<span class="sig-name descname"><span class="n"><span class="pre">assert_implements</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_implements" title="Link to this definition">¶</a></dt>
<dd><p>Assert that a feature is implemented, based on a ‘truthy’ condition.</p>
<p>This function should be used to early-exit from tests in which there is
no point continuing without support for a non-optional spec or spec
feature. For example:</p>
<blockquote>
<div><p>assert_implements(window.Foo, ‘Foo is not supported’);</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>condition</strong> (<em>object</em>) – The truthy value to test</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error description for the case that the condition is not truthy.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_implements_optional">
<span class="sig-name descname"><span class="n"><span class="pre">assert_implements_optional</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_implements_optional" title="Link to this definition">¶</a></dt>
<dd><p>Assert that an optional feature is implemented, based on a ‘truthy’ condition.</p>
<p>This function should be used to early-exit from tests in which there is
no point continuing without support for an explicitly optional spec or
spec feature. For example:</p>
<blockquote>
<div><dl class="simple">
<dt>assert_implements_optional(video.canPlayType(“video/webm”),</dt><dd><p>“webm video playback not supported”);</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>condition</strong> (<em>object</em>) – The truthy value to test</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error description for the case that the condition is not truthy.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_unreached">
<span class="sig-name descname"><span class="n"><span class="pre">assert_unreached</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_unreached" title="Link to this definition">¶</a></dt>
<dd><p>Asserts if called. Used to ensure that a specific codepath is
not taken e.g. that an error event isn’t fired.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="assert_any">
<span class="sig-name descname"><span class="n"><span class="pre">assert_any</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">assert_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actual</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">...args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assert_any" title="Link to this definition">¶</a></dt>
<dd><p>Asserts that <code class="docutils literal notranslate"><span class="pre">actual</span></code> matches at least one value of <code class="docutils literal notranslate"><span class="pre">expected</span></code>
according to a comparison defined by <code class="docutils literal notranslate"><span class="pre">assert_func</span></code>.</p>
<p>Note that tests with multiple allowed pass conditions are bad
practice unless the spec specifically allows multiple
behaviours. Test authors should not use this method simply to
hide UA bugs.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>assert_func</strong> (<em>AssertFunc</em>) – Function to compare actual and expected. It must throw when the comparison fails and return when the comparison passes.</p></li>
<li><p><strong>actual</strong> (<em>Any</em>) – Test value.</p></li>
<li><p><strong>expected_array</strong> (<em>Array</em>) – Array of possible expected values.</p></li>
<li><p><strong>args</strong> (<em>Array.&lt;Any&gt;</em>) – Additional arguments to pass to <code class="docutils literal notranslate"><span class="pre">assert_func</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>Assertions fail by throwing an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>:</p>
<dl class="js class">
<dt class="sig sig-object js" id="AssertionError">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">AssertionError</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#AssertionError" title="Link to this definition">¶</a></dt>
<dd><p>Exception type that represents a failing assert.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> (<em>string</em>) – Error message.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<section id="promise-rejection">
<h3>Promise Rejection<a class="headerlink" href="#promise-rejection" title="Link to this heading">¶</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="promise_rejects_dom">
<span class="sig-name descname"><span class="n"><span class="pre">promise_rejects_dom</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">promiseOrConstructor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">descriptionOrPromise</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#promise_rejects_dom" title="Link to this definition">¶</a></dt>
<dd><p>Assert that a Promise is rejected with the right DOMException.</p>
<p>For the remaining arguments, there are two ways of calling
promise_rejects_dom:</p>
<p>1) If the DOMException is expected to come from the current global, the
third argument should be the promise expected to reject, and a fourth,
optional, argument is the assertion description.</p>
<p>2) If the DOMException is expected to come from some other global, the
third argument should be the DOMException constructor from that global,
the fourth argument the promise expected to reject, and the fifth,
optional, argument the assertion description.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> (<a class="reference internal" href="#Test" title="Test"><em>Test</em></a>) – the <cite>Test</cite> to use for the assertion.</p></li>
<li><p><strong>type</strong> (<em>number|string</em>) – See documentation for <a class="reference external" href="#assert_throws_dom">assert_throws_dom</a>.</p></li>
<li><p><strong>promiseOrConstructor</strong> (<em>function</em>) – Either the constructor for the expected exception (if the exception comes from another global), or the promise that’s expected to reject (if the exception comes from the current global).</p></li>
<li><p><strong>descriptionOrPromise</strong> (<em>function|string</em>) – Either the promise that’s expected to reject (if the exception comes from another global), or the optional description of the condition being tested (if the exception comes from the current global).</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Description of the condition being tested (if the exception comes from another global).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="promise_rejects_js">
<span class="sig-name descname"><span class="n"><span class="pre">promise_rejects_js</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constructor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">promise</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#promise_rejects_js" title="Link to this definition">¶</a></dt>
<dd><p>Assert that a Promise is rejected with the right ECMAScript exception.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> (<a class="reference internal" href="#Test" title="Test"><em>Test</em></a>) – the <cite>Test</cite> to use for the assertion.</p></li>
<li><p><strong>constructor</strong> (<em>function</em>) – The expected exception constructor.</p></li>
<li><p><strong>promise</strong> (<em>Promise</em>) – The promise that’s expected to reject with the given exception.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error message to add to assert in case of failure.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="promise_rejects_exactly">
<span class="sig-name descname"><span class="n"><span class="pre">promise_rejects_exactly</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exception</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">promise</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#promise_rejects_exactly" title="Link to this definition">¶</a></dt>
<dd><p>Assert that a Promise is rejected with the provided value.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> (<a class="reference internal" href="#Test" title="Test"><em>Test</em></a>) – the <cite>Test</cite> to use for the assertion.</p></li>
<li><p><strong>exception</strong> (<em>Any</em>) – The expected value of the rejected promise.</p></li>
<li><p><strong>promise</strong> (<em>Promise</em>) – The promise that’s expected to reject.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error message to add to assert in case of failure.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">promise_rejects_dom</span></code>, <code class="docutils literal notranslate"><span class="pre">promise_rejects_js</span></code>, and <code class="docutils literal notranslate"><span class="pre">promise_rejects_exactly</span></code> can
be used to test Promises that need to reject.</p>
<p>Here’s an example where the <code class="docutils literal notranslate"><span class="pre">bar()</span></code> function returns a Promise that rejects
with a TypeError:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">TypeError</span><span class="p">());</span>
<span class="p">}</span>

<span class="nx">promise_test</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">promise_rejects_js</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="ne">TypeError</span><span class="p">,</span><span class="w"> </span><span class="nx">bar</span><span class="p">());</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;Another example&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="test-objects">
<h2>Test Objects<a class="headerlink" href="#test-objects" title="Link to this heading">¶</a></h2>
<dl class="js class">
<dt class="sig sig-object js" id="Test">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">Test</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test" title="Link to this definition">¶</a></dt>
<dd><p>A single subtest. A Test is not constructed directly but via the
<a class="reference internal" href="#test" title="test"><code class="xref js js-func docutils literal notranslate"><span class="pre">test()</span></code></a>, <a class="reference internal" href="#async_test" title="async_test"><code class="xref js js-func docutils literal notranslate"><span class="pre">async_test()</span></code></a> or <a class="reference internal" href="#promise_test" title="promise_test"><code class="xref js js-func docutils literal notranslate"><span class="pre">promise_test()</span></code></a> functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>string</em>) – This must be unique in a given file and must be invariant between runs.</p></li>
</ul>
</dd>
</dl>
<dl class="js attribute">
<dt class="sig sig-object js" id="Test.message">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">message</span></span></span><a class="headerlink" href="#Test.message" title="Link to this definition">¶</a></dt>
<dd><p>A message indicating the reason for test failure.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="Test.name">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">name</span></span></span><a class="headerlink" href="#Test.name" title="Link to this definition">¶</a></dt>
<dd><p>The test name.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="Test.stack">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">stack</span></span></span><a class="headerlink" href="#Test.stack" title="Link to this definition">¶</a></dt>
<dd><p>Stack trace in case of failure.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="Test.status">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">status</span></span></span><a class="headerlink" href="#Test.status" title="Link to this definition">¶</a></dt>
<dd><p>The test status code.</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="Test.statuses">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">statuses</span></span></span><a class="headerlink" href="#Test.statuses" title="Link to this definition">¶</a></dt>
<dd><p>Enum of possible test statuses.</p>
<dl class="field-list simple">
<dt class="field-odd">Values<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PASS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FAIL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NOTRUN</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PRECONDITION_FAILED</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.add_cleanup">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">add_cleanup</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.add_cleanup" title="Link to this definition">¶</a></dt>
<dd><p>Schedule a function to be run after the test result is known, regardless
of passing or failing state.</p>
<p>The behavior of this function will not
influence the result of the test, but if an exception is thrown, the
test harness will report an error.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>callback</strong> (<em>function</em>) – The cleanup function to run. This is called with no arguments.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.done">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">done</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Test.done" title="Link to this definition">¶</a></dt>
<dd><p>Mark the test as complete.</p>
<p>This sets the test status to <code class="docutils literal notranslate"><span class="pre">PASS</span></code> if no other status was
already recorded. Any subsequent attempts to run additional
test steps will be ignored.</p>
<p>After setting the test status any test cleanup functions will
be run.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.force_timeout">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">force_timeout</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Test.force_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Manually set the test status to <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>.</p>
<p>Alias for <a class="reference external" href="#Test.timeout">Test.timeout</a>.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.get_signal">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">get_signal</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Test.get_signal" title="Link to this definition">¶</a></dt>
<dd><p>Gives an AbortSignal that will be aborted when the test finishes.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.step">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">this_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.step" title="Link to this definition">¶</a></dt>
<dd><p>Run a single step of an ongoing test.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>string</em>) – Callback function to run as a step. If this throws an <a class="reference internal" href="#AssertionError" title="AssertionError"><code class="xref js js-func docutils literal notranslate"><span class="pre">AssertionError()</span></code></a>, or any other exception, the <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> status is set to <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>.</p></li>
<li><p><strong>this_obj</strong> (<em>Object</em>) – The object to use as the this value when calling <code class="docutils literal notranslate"><span class="pre">func</span></code>. Defaults to the  <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> object.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.step_func">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step_func</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">this_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.step_func" title="Link to this definition">¶</a></dt>
<dd><p>Wrap a function so that it runs as a step of the current test.</p>
<p>This allows creating a callback function that will run as a
test step.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>string</em>) – Function to run as a step. If this throws an <a class="reference internal" href="#AssertionError" title="AssertionError"><code class="xref js js-func docutils literal notranslate"><span class="pre">AssertionError()</span></code></a>, or any other exception, the <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> status is set to <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>.</p></li>
<li><p><strong>this_obj</strong> (<em>Object</em>) – The object to use as the this value when calling <code class="docutils literal notranslate"><span class="pre">func</span></code>. Defaults to the <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> object.</p></li>
</ul>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">async_test</span><span class="p">(</span><span class="s2">&quot;Example&quot;</span><span class="p">);</span>
<span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;load&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Mark the test as complete.</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
<span class="p">})</span>
</pre></div>
</div>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.step_func_done">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step_func_done</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">this_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.step_func_done" title="Link to this definition">¶</a></dt>
<dd><p>Wrap a function so that it runs as a step of the current test,
and automatically marks the test as complete if the function
returns without error.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>string</em>) – Function to run as a step. If this throws an <a class="reference internal" href="#AssertionError" title="AssertionError"><code class="xref js js-func docutils literal notranslate"><span class="pre">AssertionError()</span></code></a>, or any other exception, the <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> status is set to <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>. If it returns without error the status is set to <code class="docutils literal notranslate"><span class="pre">PASS</span></code>.</p></li>
<li><p><strong>this_obj</strong> (<em>Object</em>) – The object to use as the this value when calling <cite>func</cite>. Defaults to the <a class="reference internal" href="#Test" title="Test"><code class="xref js js-class docutils literal notranslate"><span class="pre">Test()</span></code></a> object.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.step_timeout">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step_timeout</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.step_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Run a function as a step of the test after a given timeout.</p>
<p>This multiplies the timeout by the global timeout multiplier to
account for the expected execution speed of the current test
environment. For example <code class="docutils literal notranslate"><span class="pre">test.step_timeout(f,</span> <span class="pre">2000)</span></code> with a
timeout multiplier of 2 will wait for 4000ms before calling <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
<p>In general it’s encouraged to use <a class="reference internal" href="#Test.step_wait" title="Test.step_wait"><code class="xref js js-func docutils literal notranslate"><span class="pre">Test.step_wait()</span></code></a> or
<a class="reference internal" href="#Test.step_wait_func" title="Test.step_wait_func"><code class="xref js js-func docutils literal notranslate"><span class="pre">step_wait_func()</span></code></a> in preference to this function where possible,
as they provide better test performance.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>function</em>) – Function to run as a test step.</p></li>
<li><p><strong>timeout</strong> (<em>number</em>) – Time in ms to wait before running the test step. The actual wait time is <code class="docutils literal notranslate"><span class="pre">timeout</span></code> x <code class="docutils literal notranslate"><span class="pre">timeout_multiplier</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.step_wait">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step_wait</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cond</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interval</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.step_wait" title="Link to this definition">¶</a></dt>
<dd><p>Poll for a function to return true, and resolve a promise
once it does, or assert if a timeout is reached. This is
preferred over a simple step_timeout whenever possible
since it allows the timeout to be longer to reduce
intermittents without compromising test execution speed
when the condition is quickly met.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> (<em>function</em>) – A function taking no arguments and returning a boolean or a Promise.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error message to add to assert in case of failure.</p></li>
<li><p><strong>timeout</strong> (<em>number</em>) – Timeout in ms. This is multiplied by the global timeout_multiplier</p></li>
<li><p><strong>interval</strong> (<em>number</em>) – Polling interval in ms</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Promise</strong> – Promise resolved once cond is met.</p>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">promise_test</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="c1">// …</span>
<span class="k">await</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">step_wait</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">frame</span><span class="p">.</span><span class="nx">contentDocument</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Frame navigated to a cross-origin document&quot;</span><span class="p">);</span>
<span class="c1">// …</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.step_wait_func">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step_wait_func</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cond</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interval</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.step_wait_func" title="Link to this definition">¶</a></dt>
<dd><p>Poll for a function to return true, and call a callback
function once it does, or assert if a timeout is
reached. This is preferred over a simple step_timeout
whenever possible since it allows the timeout to be longer
to reduce intermittents without compromising test execution
speed when the condition is quickly met.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> (<em>function</em>) – A function taking no arguments and returning a boolean or a Promise. The callback is called when this function returns true, or the returned Promise is resolved with true.</p></li>
<li><p><strong>func</strong> (<em>function</em>) – A function taking no arguments to call once the condition is met.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error message to add to assert in case of failure.</p></li>
<li><p><strong>timeout</strong> (<em>number</em>) – Timeout in ms. This is multiplied by the global timeout_multiplier</p></li>
<li><p><strong>interval</strong> (<em>number</em>) – Polling interval in ms</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.step_wait_func_done">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step_wait_func_done</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cond</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">description</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interval</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.step_wait_func_done" title="Link to this definition">¶</a></dt>
<dd><p>Poll for a function to return true, and invoke a callback
followed by this.done() once it does, or assert if a timeout
is reached. This is preferred over a simple step_timeout
whenever possible since it allows the timeout to be longer
to reduce intermittents without compromising test execution speed
when the condition is quickly met.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> (<em>function</em>) – A function taking no arguments and returning a boolean or a Promise. The callback is called when this function returns true, or the returned Promise is resolved with true.</p></li>
<li><p><strong>func</strong> (<em>function</em>) – A function taking no arguments to call once the condition is met.</p></li>
<li><p><strong>description</strong> (<em>string</em>) – Error message to add to assert in case of failure.</p></li>
<li><p><strong>timeout</strong> (<em>number</em>) – Timeout in ms. This is multiplied by the global timeout_multiplier</p></li>
<li><p><strong>interval</strong> (<em>number</em>) – Polling interval in ms</p></li>
</ul>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">async_test</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;resources/coop-coep.py?coop=same-origin&amp;coep=&amp;navigate=about:blank&quot;</span><span class="p">);</span>
<span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">add_cleanup</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">popup</span><span class="p">.</span><span class="nx">close</span><span class="p">());</span>
<span class="w"> </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span><span class="w"> </span><span class="nx">popup</span><span class="p">.</span><span class="nx">opener</span><span class="p">);</span>

<span class="w"> </span><span class="nx">popup</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">assert_true</span><span class="p">(</span><span class="nx">popup</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s2">&quot;&amp;navigate=about:blank&quot;</span><span class="p">));</span>
<span class="w">   </span><span class="c1">// Use step_wait_func_done as about:blank cannot message back.</span>
<span class="w">   </span><span class="nx">t</span><span class="p">.</span><span class="nx">step_wait_func_done</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">popup</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;about:blank&quot;</span><span class="p">);</span>
<span class="w"> </span><span class="p">});</span>
<span class="p">},</span><span class="w"> </span><span class="s2">&quot;Navigating a popup to about:blank&quot;</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.timeout">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">timeout</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Test.timeout" title="Link to this definition">¶</a></dt>
<dd><p>Manually set the test status to <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="Test.unreached_func">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Test</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">unreached_func</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">description</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Test.unreached_func" title="Link to this definition">¶</a></dt>
<dd><p>Return a function that automatically sets the current test to
<code class="docutils literal notranslate"><span class="pre">FAIL</span></code> if it’s called.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>description</strong> (<em>string</em>) – Error message to add to assert in case of failure.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="helpers">
<h2>Helpers<a class="headerlink" href="#helpers" title="Link to this heading">¶</a></h2>
<section id="waiting-for-events">
<h3>Waiting for events<a class="headerlink" href="#waiting-for-events" title="Link to this heading">¶</a></h3>
<dl class="js class">
<dt class="sig sig-object js" id="EventWatcher">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">EventWatcher</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">watchedNode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eventTypes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeoutPromise</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#EventWatcher" title="Link to this definition">¶</a></dt>
<dd><p>Allow DOM events to be handled using Promises.</p>
<p>This can make it a lot easier to test a very specific series of events,
including ensuring that unexpected events are not fired at any point.</p>
<p><cite>EventWatcher</cite> will assert if an event occurs while there is no <cite>wait_for</cite>
created Promise waiting to be fulfilled, or if the event is of a different type
to the type currently expected. This ensures that only the events that are
expected occur, in the correct order, and with the correct timing.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> (<a class="reference internal" href="#Test" title="Test"><em>Test</em></a>) – The <cite>Test</cite> to use for the assertion.</p></li>
<li><p><strong>watchedNode</strong> (<em>EventTarget</em>) – The target expected to receive the events.</p></li>
<li><p><strong>eventTypes</strong> (<em>Array.&lt;string&gt;</em>) – List of events to watch for.</p></li>
<li><p><strong>timeoutPromise</strong> (<em>Promise</em>) – Promise that will cause the test to be set to <cite>TIMEOUT</cite> once fulfilled.</p></li>
</ul>
</dd>
</dl>
<dl class="js function">
<dt class="sig sig-object js" id="EventWatcher.stop_watching">
<span class="sig-prename descclassname"><span class="n"><span class="pre">EventWatcher</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">stop_watching</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#EventWatcher.stop_watching" title="Link to this definition">¶</a></dt>
<dd><p>Stop listening for events</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="EventWatcher.wait_for">
<span class="sig-prename descclassname"><span class="n"><span class="pre">EventWatcher</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">wait_for</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">options</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#EventWatcher.wait_for" title="Link to this definition">¶</a></dt>
<dd><p>Returns a Promise that will resolve after the specified event or
series of events has occurred.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>options</strong> (<em>Object</em>) – An optional options object. If the ‘record’ property on this object has the value ‘all’, when the Promise returned by this function is resolved,  <em>all</em> Event objects that were waited for will be returned as an array.</p></li>
</ul>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">watcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventWatcher</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">div</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;animationstart&#39;</span><span class="p">,</span>
<span class="w">                                           </span><span class="s1">&#39;animationiteration&#39;</span><span class="p">,</span>
<span class="w">                                           </span><span class="s1">&#39;animationend&#39;</span><span class="w"> </span><span class="p">]);</span>
<span class="k">return</span><span class="w"> </span><span class="nx">watcher</span><span class="p">.</span><span class="nx">wait_for</span><span class="p">([</span><span class="w"> </span><span class="s1">&#39;animationstart&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;animationend&#39;</span><span class="w"> </span><span class="p">],</span>
<span class="w">                        </span><span class="p">{</span><span class="w"> </span><span class="nx">record</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="w"> </span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">evts</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nx">evts</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">elapsedTime</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<span class="w">  </span><span class="nx">assert_equals</span><span class="p">(</span><span class="nx">evts</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">elapsedTime</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<p>Here’s an example of how to use <code class="docutils literal notranslate"><span class="pre">EventWatcher</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">async_test</span><span class="p">(</span><span class="s2">&quot;Event order on animation start&quot;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">animation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">watchedNode</span><span class="p">.</span><span class="nx">getAnimations</span><span class="p">()[</span><span class="mf">0</span><span class="p">];</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">eventWatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventWatcher</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">watchedNode</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;animationstart&#39;</span><span class="p">,</span>
<span class="w">                                                     </span><span class="s1">&#39;animationiteration&#39;</span><span class="p">,</span>
<span class="w">                                                     </span><span class="s1">&#39;animationend&#39;</span><span class="p">]);</span>

<span class="nx">eventWatcher</span><span class="p">.</span><span class="nx">wait_for</span><span class="p">(</span><span class="s1">&#39;animationstart&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assertExpectedStateAtStartOfAnimation</span><span class="p">();</span>
<span class="w">  </span><span class="nx">animation</span><span class="p">.</span><span class="nx">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">END_TIME</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip to end</span>
<span class="w">  </span><span class="c1">// We expect two animationiteration events then an animationend event on</span>
<span class="w">  </span><span class="c1">// skipping to the end of the animation.</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">eventWatcher</span><span class="p">.</span><span class="nx">wait_for</span><span class="p">([</span><span class="s1">&#39;animationiteration&#39;</span><span class="p">,</span>
<span class="w">                                </span><span class="s1">&#39;animationiteration&#39;</span><span class="p">,</span>
<span class="w">                                </span><span class="s1">&#39;animationend&#39;</span><span class="p">]);</span>
<span class="p">})).</span><span class="nx">then</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">step_func</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">assertExpectedStateAtEndOfAnimation</span><span class="p">();</span>
<span class="w">  </span><span class="nx">t</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
<span class="p">}));</span>
</pre></div>
</div>
</section>
<section id="loading-test-data-from-json-files">
<h3>Loading test data from JSON files<a class="headerlink" href="#loading-test-data-from-json-files" title="Link to this heading">¶</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="fetch_json">
<span class="sig-name descname"><span class="n"><span class="pre">fetch_json</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fetch_json" title="Link to this definition">¶</a></dt>
<dd><p>Fetches a JSON resource and parses it</p>
</dd></dl>

<p>Loading test data from a JSON file would normally be accomplished by
something like this:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">promise_test</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;resources/my_data.json&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="nx">runTests</span><span class="p">));</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">runTests</span><span class="p">(</span><span class="nx">myData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">/// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> is not exposed inside ShadowRealm scopes, so if the
test is to be run inside a ShadowRealm, use <code class="docutils literal notranslate"><span class="pre">fetch_json()</span></code> instead:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">promise_test</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fetch_json</span><span class="p">(</span><span class="s1">&#39;resources/my_data.json&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">runTests</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="utility-functions">
<h3>Utility Functions<a class="headerlink" href="#utility-functions" title="Link to this heading">¶</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="format_value">
<span class="sig-name descname"><span class="n"><span class="pre">format_value</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#format_value" title="Link to this definition">¶</a></dt>
<dd><p>Convert a value to a nice, human-readable string</p>
<p>When many JavaScript Object values are coerced to a String, the
resulting value will be <code class="docutils literal notranslate"><span class="pre">&quot;[object</span> <span class="pre">Object]&quot;</span></code>. This obscures
helpful information, making the coerced value unsuitable for
use in assertion messages, test names, and debugging
statements. <cite>format_value</cite> produces more distinctive string
representations of many kinds of objects, including arrays and
the more important DOM Node types. It also translates String
values containing control characters to include human-readable
representations.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>val</strong> (<em>Any</em>) – The value to convert to a string.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>string</strong> – - A string representation of <code class="docutils literal notranslate"><span class="pre">val</span></code>, optimised for human readability.</p>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// &quot;Document node with 2 children&quot;</span>
<span class="nx">format_value</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// &quot;\&quot;foo\\uffffbar\&quot;&quot;</span>
<span class="nx">format_value</span><span class="p">(</span><span class="s2">&quot;foo\uffffbar&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// &quot;[-0, Infinity]&quot;</span>
<span class="nx">format_value</span><span class="p">([</span><span class="o">-</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="kc">Infinity</span><span class="p">]);</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="deprecated-apis">
<h2>Deprecated APIs<a class="headerlink" href="#deprecated-apis" title="Link to this heading">¶</a></h2>
<dl class="js function">
<dt class="sig sig-object js" id="generate_tests">
<span class="sig-name descname"><span class="n"><span class="pre">generate_tests</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#generate_tests" title="Link to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Deprecated: generate a list of tests from a function and list of arguments</p>
</div>
<p>This is deprecated because it runs all the tests outside of the test functions
and as a result any test throwing an exception will result in no tests being
run. In almost all cases, you should simply call test within the loop you would
use to generate the parameter list array.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>function</em>) – The function that will be called for each generated tests.</p></li>
<li><p><strong>args</strong> (<em>Array.&lt;Array.&lt;Any&gt;&gt;</em>) – An array of arrays. Each nested array has the structure <cite>[testName, …testArgs]</cite>. For each of these nested arrays array, a test is generated with name <cite>testName</cite> and test function equivalent to <cite>func(..testArgs)</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="on_event">
<span class="sig-name descname"><span class="n"><span class="pre">on_event</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#on_event" title="Link to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Deprecated: Register a function as a DOM event listener to the</p>
</div>
<p>given object for the event bubbling phase.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object</strong> (<em>EventTarget</em>) – Event target</p></li>
<li><p><strong>event</strong> (<em>string</em>) – Event name</p></li>
<li><p><strong>callback</strong> (<em>function</em>) – Event handler.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro-video-transcript.html">“Introduction to WPT” video transcript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running-tests/index.html">Running Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Writing Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#test-types">Test Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#submitting-tests">Submitting Tests</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#table-of-contents">Table of Contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin/index.html">Project Administration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Writing Tests</a><ul>
  <li><a href="testharness.html">JavaScript Tests (testharness.js)</a><ul>
      <li>Previous: <a href="testharness.html" title="previous chapter">JavaScript Tests (testharness.js)</a></li>
      <li>Next: <a href="testdriver.html" title="next chapter">testdriver.js Automation</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, wpt contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/writing-tests/testharness-api.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>